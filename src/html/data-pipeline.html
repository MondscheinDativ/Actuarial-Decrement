<div class="container-fluid mt-4">
    <div class="row">
        <!-- Left sidebar -->
        <div class="col-lg-3">
            <!-- Data source selection -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">数据源选择</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="dataSourceTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="recommended-tab" 
                                data-bs-toggle="tab" data-bs-target="#recommended" 
                                type="button">推荐数据源</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="custom-tab" 
                                data-bs-toggle="tab" data-bs-target="#custom" 
                                type="button">自定义数据</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content py-3" id="dataSourceTabsContent">
                        <!-- Recommended sources tab -->
                        <div class="tab-pane fade show active" id="recommended" role="tabpanel">
                            <div class="mb-3">
                                <label class="form-label">选择数据源</label>
                                <select class="form-select" id="dataSourceSelect">
                                    <option value="hmd">HMD (人类死亡率数据库)</option>
                                    <option value="cdc">CDC (美国疾病控制中心)</option>
                                </select>
                            </div>
                            
                            <!-- HMD credentials -->
                            <div id="hmdCredentials" class="data-credentials">
                                <div class="mb-3">
                                    <label class="form-label">HMD用户名</label>
                                    <input type="text" class="form-control" id="hmdUsername">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">HMD密码</label>
                                    <input type="password" class="form-control" id="hmdPassword">
                                </div>
                            </div>
                            
                            <!-- CDC credentials -->
                            <div id="cdcCredentials" class="data-credentials" style="display: none;">
                                <div class="mb-3">
                                    <label class="form-label">CDC API密钥</label>
                                    <input type="text" class="form-control" id="cdcApiKey">
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-100" onclick="fetchData()">
                                <i class="fas fa-download me-2"></i>获取数据
                            </button>
                        </div>
                        
                        <!-- Custom data tab -->
                        <div class="tab-pane fade" id="custom" role="tabpanel">
                            <div class="mb-3">
                                <label class="form-label">上传数据文件</label>
                                <input type="file" class="form-control" id="customDataFile" 
                                       accept=".csv,.xlsx,.xls,.sas7bdat,.dta,.sav">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">或输入API端点</label>
                                <input type="text" class="form-control" id="customApiEndpoint" 
                                       placeholder="https://api.example.com/data">
                            </div>
                            <button class="btn btn-primary w-100" onclick="processCustomData()">
                                <i class="fas fa-upload me-2"></i>处理数据
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Data filtering -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">数据筛选</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">选择表格</label>
                        <select class="form-select" id="tableSelect" disabled>
                            <option value="">请先获取数据</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">选择字段</label>
                        <select class="form-select" id="fieldSelect" multiple disabled>
                            <option value="">请先选择表格</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">时间范围</label>
                        <div class="input-group">
                            <input type="number" class="form-control" id="startYear" 
                                   placeholder="开始年份" min="1900" max="2100" disabled>
                            <span class="input-group-text">至</span>
                            <input type="number" class="form-control" id="endYear" 
                                   placeholder="结束年份" min="1900" max="2100" disabled>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" id="applyFiltersBtn" disabled>
                        <i class="fas fa-filter me-2"></i>应用筛选
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main content -->
        <div class="col-lg-9">
            <!-- Data cleaning options -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">数据清洗选项</h5>
                    <button class="btn btn-sm btn-light" data-bs-toggle="modal" 
                            data-bs-target="#cleaningHelpModal">
                        <i class="fas fa-question-circle"></i> 帮助
                    </button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">缺失值处理</label>
                                <select class="form-select" id="missingValueTreatment">
                                    <option value="drop">删除包含缺失值的行</option>
                                    <option value="mean">用平均值填充</option>
                                    <option value="median">用中位数填充</option>
                                    <option value="mode">用众数填充</option>
                                    <option value="interpolate">插值填充</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">异常值处理</label>
                                <select class="form-select" id="outlierTreatment">
                                    <option value="keep">保留异常值</option>
                                    <option value="remove">删除异常值</option>
                                    <option value="winsorize">缩尾处理</option>
                                    <option value="cap">封顶处理</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">数据标准化</label>
                                <select class="form-select" id="normalizationMethod">
                                    <option value="none">不标准化</option>
                                    <option value="zscore">Z-score标准化</option>
                                    <option value="minmax">Min-Max标准化</option>
                                    <option value="log">对数转换</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">其他选项</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="removeDuplicates">
                                    <label class="form-check-label" for="removeDuplicates">
                                        删除重复行
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="convertDataTypes">
                                    <label class="form-check-label" for="convertDataTypes">
                                        自动转换数据类型
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" id="cleanDataBtn" disabled>
                        <i class="fas fa-broom me-2"></i>清洗数据
                    </button>
                </div>
            </div>
            
            <!-- Diagnostic report -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">数据诊断报告</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="summaryStats" checked>
                                <label class="form-check-label" for="summaryStats">汇总统计</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="missingValueReport" checked>
                                <label class="form-check-label" for="missingValueReport">缺失值报告</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="outlierReport" checked>
                                <label class="form-check-label" for="outlierReport">异常值报告</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="dataDistribution" checked>
                                <label class="form-check-label" for="dataDistribution">数据分布</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="correlationMatrix">
                                <label class="form-check-label" for="correlationMatrix">相关性矩阵</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="timeSeriesAnalysis">
                                <label class="form-check-label" for="timeSeriesAnalysis">时间序列分析</label>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary w-100" id="generateReportBtn" disabled>
                        <i class="fas fa-file-alt me-2"></i>生成诊断报告
                    </button>
                    
                    <!-- Report container -->
                    <div class="mt-4" id="reportContainer" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5>诊断报告</h5>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="exportReport('pdf')">
                                    <i class="fas fa-file-pdf me-1"></i>PDF
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="exportReport('csv')">
                                    <i class="fas fa-file-csv me-1"></i>CSV
                                </button>
                            </div>
                        </div>
                        <div class="border p-3" id="reportContent"></div>
                    </div>
                </div>
            </div>
            
            <!-- Data preview -->
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">数据预览</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="dataPreview">
                            <thead>
                                <tr>
                                    <th>加载数据以预览</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="10" class="text-center text-muted py-5">暂无数据</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-between mt-3">
                        <div>
                            <button class="btn btn-outline-primary btn-sm" id="prevPageBtn" disabled>
                                <i class="fas fa-chevron-left"></i> 上一页
                            </button>
                            <button class="btn btn-outline-primary btn-sm ms-2" id="nextPageBtn" disabled>
                                下一页 <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="text-muted" id="pageInfo">第 0 页 / 共 0 页</div>
                        <button class="btn btn-primary btn-sm" id="saveDatasetBtn" disabled>
                            <i class="fas fa-save me-1"></i> 保存数据集
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Cleaning Help Modal -->
<div class="modal fade" id="cleaningHelpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">数据清洗方法说明</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>缺失值处理方法：</h6>
                <ul>
                    <li><strong>删除包含缺失值的行</strong>：直接删除任何包含缺失值的记录</li>
                    <li><strong>用平均值填充</strong>：用该变量的平均值填充缺失值</li>
                    <li><strong>用中位数填充</strong>：用该变量的中位数填充缺失值，对异常值更稳健</li>
                    <li><strong>用众数填充</strong>：用该变量最常见的值填充缺失值，适用于分类变量</li>
                    <li><strong>插值填充</strong>：根据前后值进行线性插值填充</li>
                </ul>
                
                <h6 class="mt-4">异常值处理方法：</h6>
                <ul>
                    <li><strong>保留异常值</strong>：不处理异常值</li>
                    <li><strong>删除异常值</strong>：删除被识别为异常值的记录</li>
                    <li><strong>缩尾处理</strong>：将超出指定百分位数的值替换为百分位数值</li>
                    <li><strong>封顶处理</strong>：将超出指定阈值的值替换为阈值</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>
